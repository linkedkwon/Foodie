<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="format-detection" content="telephone=no">

  <title>Foodie</title>

  <link rel="stylesheet" type="text/css" th:href="@{/css/reset.css}"/>
  <link rel="stylesheet" type="text/css" th:href="@{/css/layout.css}" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/commons.css}" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/notosanskr.css" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/detail.css}" />
</head>
<body>
<div id="app">
  <div id="contents" class="detail-blue">
    <div class="background-wrapper">
      <a href="javascript:history.back();" class="go-back">뒤로가기</a>
      <h1>
        <a href="#">
          <picture>
            <source srcset="/images/logo-detail@2x.png 2x">
            <div href="/"><img src="/images/logo-detail.png" alt="foodie"></div>
          </picture>
        </a>
      </h1>
      <div class="background-wrapper">
        <div class="background-wrapper">
          <!-- 실제 컨텐츠 영역 -->
          <div class="contents">
            <!-- header-restaurant START -->
            <div class="header-restaurant">
              <div class="left-area">
                <h2 th:text="${payload[0].shopName}"></h2>
                <div class="categories">
                  <span th:text="${category}"></span>
                </div>
<!--                빼기로함-->
<!--                <div class="categories" style="margin-top: 10px;">-->
<!--                  <a th:href="'http://epicure.co.kr/home/'+${payload[0].shopAlias}" th:text="'http://epicure.co.kr/home/'+${payload[0].shopAlias}" style="color:#838383;"></a>-->
<!--                </div>-->
              </div>

              <div class="right-area">
                <ul class="scores" th:style="${not #strings.isEmpty(payload[0].foodieLogRating)}? '':'border-right:solid 0px #e4e4e4;'">
                  <li th:text="${not #strings.isEmpty(payload[0].foodieLogRating)} ? '전문가 평점' : '전문가 평점'"></li>
                  <li>
<!--                    <b style="padding-left:17px;" th:text="${not #strings.isEmpty(payload[0].tasteRating)} ? '방문자 평점('+${payload[0].tasteRating}+'점)' : '오감 평점'"></b>-->
                    <b style="padding-left:17px;">방문자 평점</b>
<!--                    <b th:text="${not #strings.isEmpty(payload[0].tasteRating)} ? '오감 평점('+${payload[0].tasteRating}+'점)' : '오감 평점(없음)'"></b>-->

                    <!--                    <b th:text="'('+${tasteRatingCnt}+'명)'" style="font-size: 12px;"></b>-->
                  </li>
                </ul>

                <th:block th:switch="${payload[0].foodieLogRating}">
                  <div class="star" th:case="A">
                    <picture>
                      <img src="/images/ico-detail-star-first.png" style="height: 40px;">
                    </picture>
                  </div>
                  <div class="star" th:case="AA">
                    <picture>
                      <img src="/images/ico-detail-star-second.png" style="height: 40px;">
                    </picture>
                  </div>
                  <div class="star" th:case="AAA">
                    <picture>
                      <img src="/images/ico-detail-star-third.png" style="height: 40px;">
                    </picture>
                  </div>
                  <div class="star" th:case="없음">
                    <picture>
                      <img src="/images/noRating.png" style="height: 40px;">
                    </picture>
                  </div>
                </th:block>

                <th:block th:switch="${payload[0].tasteRating}">
                  <div th:case="5">
                    <picture style="float: left">
                      <img src="/images/ico-point-5-active.png" style="margin-top: 5px; padding-left: 10px; margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div th:if="${(not #strings.isEmpty(payload[0].tasteRating)) && (!payload[0].tasteRating.toString().equals('0'))}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="'('+${payload[0].tasteRating}+'점)'"></div>
                    </div>
                    <div th:unless="${not #strings.isEmpty(payload[0].tasteRating)}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;">( - )</div>
                    </div>
                  </div>
                  <div th:case="4">
                    <picture style="float: left">
                      <img src="/images/ico-point-4-active.png" style="margin-top: 5px; padding-left: 10px;margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="${not #strings.isEmpty(payload[0].tasteRating)} ? '('+${payload[0].tasteRating}+'점)' : ''"></div>
                  </div>
                  <div th:case="3">
                    <picture style="float: left">
                      <img src="/images/ico-point-3-active.png" style="margin-top: 5px; padding-left: 10px;margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div th:if="${(not #strings.isEmpty(payload[0].tasteRating)) && (!payload[0].tasteRating.toString().equals('0'))}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="'('+${payload[0].tasteRating}+'점)'"></div>
                    </div>
                    <div th:unless="${not #strings.isEmpty(payload[0].tasteRating)}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;">( - )</div>
                    </div>
                  </div>
                  <div th:case="2">
                    <picture style="float: left">
                      <img src="/images/ico-point-2-active.png" style="margin-top: 5px; padding-left: 10px;margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div th:if="${(not #strings.isEmpty(payload[0].tasteRating)) && (!payload[0].tasteRating.toString().equals('0'))}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="'('+${payload[0].tasteRating}+'점)'"></div>
                    </div>
                    <div th:unless="${not #strings.isEmpty(payload[0].tasteRating)}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;">( - )</div>
                    </div>
                  </div>
                  <div th:case="1">
                    <picture style="float: left">
                      <img src="/images/ico-point-1-active.png" style="margin-top: 5px; padding-left: 10px;margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div th:if="${(not #strings.isEmpty(payload[0].tasteRating)) && (!payload[0].tasteRating.toString().equals('0'))}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="'('+${payload[0].tasteRating}+'점)'"></div>
                    </div>
                    <div th:unless="${not #strings.isEmpty(payload[0].tasteRating)}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;">( - )</div>
                    </div>
                  </div>
                  <div th:case="0">
                    <picture style="float: left">
                      <img src="/images/noRating.png" style="margin-top: 5px;padding-left: 10px; margin-bottom: 5px; height: 25px;">
                    </picture>
                    <div th:if="${(not #strings.isEmpty(payload[0].tasteRating)) && (!payload[0].tasteRating.toString().equals('0'))}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="'('+${payload[0].tasteRating}+'점)'"></div>
                    </div>
                    <div th:unless="${not #strings.isEmpty(payload[0].tasteRating)}">
                      <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;">( - )</div>
                    </div>
<!--                    <div style="float: left;margin-top: 10px;padding-left: 7px;color: #838383;" th:text="${not #strings.isEmpty(payload[0].tasteRating)} ? '('+${payload[0].tasteRating}+'점)' : ''"></div>-->
                  </div>
                </th:block>
                <a href="#" class="btn-print">인쇄하기</a>
              </div>
            </div>
            <!-- header-restaurant END -->

            <!-- about-restaurant START -->
            <div class="about-restaurant">
              <img class="left-area" th:src="${payload[0].shopImage}" onerror="this.src='/images/default.png'">

              <div class="right-area">

                <!-- 1. 주소-->
                <th:block th:if="${not #strings.isEmpty(payload[0].address)}">
                  <dl>
                    <dt>주소</dt>
                    <dd>
                      <p id="normal-address" th:text="${payload[0].address}"></p>
                      <div style="margin-top: 2px;">
                        <div style="width: 26px;height: 15px;margin: 6px 5px 6px 0px;padding: 3px 3px 1px 7px;border-radius: 4px;background-color: #9d9d9d ; display: inline; font-family: NotoSansKR;font-size: 10px;font-weight: normal;font-stretch: normal;font-style: normal;line-height: 2;letter-spacing: normal;text-align: left;color: #fff;">
                          도로명
                        </div>
                        <b id="road-address" th:text="${payload[0].roadAddress}"></b>
                      </div>
                    </dd>
                  </dl>
                </th:block>
                <!-- 2. 전화번호-->
                <th:block th:if="${not #strings.isEmpty(payload[0].phone)}">
                  <dl class="line">
                    <dt>전화번호</dt>
                    <dd th:text="${payload[0].phone}"></dd>
                  </dl>
                </th:block>

                <!-- 3. 찾아가는 길-->
                <th:block th:if="${not #strings.isEmpty(payload[0].detailAddress)}">
                  <dl class="line">
                    <dt>찾아가는 길</dt>
                    <dd th:text="${payload[0].detailAddress}"></dd>
                  </dl>
                </th:block>

                <!-- 4. 영업시간-->
                <th:block th:if="${not #strings.isEmpty(payload[0].operationTime)}">
                  <dl>
                    <dt>영업시간</dt>
                    <dd th:text="${payload[0].operationTime}"></dd>
                  </dl>
                </th:block>

                <!-- 5. 휴무일-->
                <th:block th:if="${not #strings.isEmpty(payload[0].holiday)}">
                  <dl class="line">
                    <dt>휴무일</dt>
                    <dd th:text="${payload[0].holiday}"></dd>
                  </dl>
                </th:block>

                <!-- 6. 추천메뉴-->
                <th:block th:if="${not #strings.isEmpty(payload[0].recommandMenu)}">
                  <dl>
                    <dt>추천메뉴</dt>
                    <dd th:text="${payload[0].recommandMenu}">닭구이</dd>
                  </dl>
                </th:block>

                <!-- 7. 예약-->
                <th:block th:if="${not #strings.isEmpty(payload[0].isReservation)}">
                  <dl>
                    <dt>예약</dt>
                    <dd th:text="${payload[0].isReservation}"></dd>
                  </dl>
                </th:block>

                <!-- 8. 주차장-->
                <th:block th:if="${not #strings.isEmpty(payload[0].isParking)}">
                  <dl>
                    <dt>주차장</dt>
                    <dd th:text="${payload[0].isParking}"></dd>
                  </dl>
                </th:block>

                <!-- 9. 예산-->
                <th:block th:if="${not #strings.isEmpty(payload[0].budget)}">
                  <dl class="line">
                    <dt>예산</dt>
                    <dd th:text="${payload[0].budget}"></dd>
                  </dl>
                </th:block>

                <!--10. 홈페이지-->
                <th:block th:if="${not #strings.isEmpty(payload[0].homepage)}">
                  <dl>
                    <dt>홈페이지</dt>
                    <dd th:text="${payload[0].homepage}"></dd>
                  </dl>
                </th:block>

                <!--11. 포장 및 배달 -->
                <th:block th:if="${not #strings.isEmpty(payload[0].isDelivery)}">
                  <dt>포장 | 배달</dt>
                  <dd th:text="${payload[0].isDelivery}"></dd>
                </th:block>

                <dd class="btn-dd">
                  <div class="util-btn-area" style="float: right;">
                    <a href="javascript:void(0)" class="btn-sm btn-heart" onclick="addFavoriteShop()">찜하기</a>
                    <a href="javascript:void(0)" class="btn-sm btn-siren" onclick="inquiryBtn()">오류신고</a>
                  </div>
                </dd>
                </dl>
              </div>
            </div>
            <!-- about-restaurant END -->

            <div class="detail-section hashtag-section">
              <th:block th:object="${tag}" th:each="tag : ${hashTags}">
                <a th:text="${tag.tagName}"></a>
              </th:block>
            </div>

            <!-- history-section START -->
            <div class="detail-section history-section">
              <div class="section-header">
                <h3>HISTORY</h3>
                <div th:if="${userRole} == 'GENERAL'"  style="float: right;margin-top: -17px;">
                  <div style="float:left">Foodie Premium으로 광고 없이 세부 정보를 이용하세요.</div>
                  <button style="margin-top: -7px;width: 124px;margin-left: 10px;height: 30px;border-radius: 26px;box-shadow: 0 3px 6px 0 rgb(0 0 0 / 13%);border: solid 1px #e8e8e8;background-color: #fff;float: left;" onclick="location.href='/user/pay'">지금 가입하기 </button>
                </div>
                <div th:unless="${userRole} == 'GENERAL'">

                </div>
              </div>
              <div class="section-body" >
                <p th:if="${userRole} == 'GENERAL'"> </p><br/>
                <p th:unless="${userRole} == 'GENERAL'"  th:utext="${payload[0].history}"></p>
              </div>
            </div>
            <!-- history-section END -->
            <div class="ad-banner" style="width: 100%">
              <a href="#" class="btn-close"></a>
            </div>
            <!-- menu-section START -->
            <div class="detail-section menu-section" style="padding-top: 20px;">
              <div class="section-header">
                <div>
                  <h3>MENU</h3>
                  <div th:if="${userRole} == 'GENERAL'"  style="float: right;margin-top: -17px;">
                    <div style="float:left">Foodie Premium으로 광고 없이 세부 정보를 이용하세요.</div>
                    <button style="margin-top: -7px;width: 124px;margin-left: 10px;height: 30px;border-radius: 26px;box-shadow: 0 3px 6px 0 rgb(0 0 0 / 13%);border: solid 1px #e8e8e8;background-color: #fff;float: left;" onclick="location.href='/user/pay'">지금 가입하기 </button>
                  </div>
                  <div th:unless="${userRole} == 'GENERAL'">

                  </div>
                </div>
              </div>

              <div class="section-body">
                <div th:if="${userRole} == 'GENERAL'" style="padding-bottom: 20px;">
                  <p></p>
                </div>
                <div th:unless="${userRole} == 'GENERAL'" class="image-thumbnails">

                  <th:block th:if="${not #strings.isEmpty(payload[0].menuImages.split(',')[0])}">
                    <div id="menu-img-main" class="detail" th:style="'background-image:url('+${payload[0].menuImages.split(',')[0]}+'); background-size:contain;'">
                    </div>

                    <ul>
                      <li th:each="item : ${payload[0].menuImages.split(',')}">
                        <img th:src='${item}' style="width: 100%;height: 100%;" onclick="changeMenuImage(this)">
                      </li>
                    </ul>
                  </th:block>
                </div>

                <ul class="info">
                  <li>
                    <dl>
                      <dt>메뉴</dt>
                      <dd th:text="${payload[0].menu}"></dd>
                    </dl>
                  </li>
                  <li>
                    <dl>
                      <dt>부가세</dt>
                      <dd></dd>
                    </dl>
                  </li>
                </ul>
              </div>
            </div>
            <!-- menu-section END -->

            <!-- map-section START -->
            <div class="detail-section map-section">
              <div class="section-header">
                <h3>MAP</h3>
                <ul>
                  <li class="naver"><a th:href="@{'https://pcmap.place.naver.com/restaurant/'+ ${payload[0].blogShopId} + '/review/ugc'}" target="_blank">블로그 리뷰 보기</a></li>
                  <li class="instagram"><a th:href="@{'https://www.instagram.com/explore/tags/'+ ${payload[0].instaKeyword}}" target="_blank">인스타 이미지 보기</a></li>
                </ul>
              </div>

              <div class="section-body">
                <div id="restaurant-map"></div>
                <div id="clickLatlng"></div>
              </div>
            </div>
            <!-- map-section END -->

            <div class="detail-section critique-section">
              <div class="section-header">
                <h3>CRITIQUE</h3>
                <span>- 나의 오감을 만족시켰는가?</span>
                <div class="score-info">
                  5.0 탁월 4.0 감동 3.0 좋음 2.0 평범 1.0 실망
                </div>
              </div>

              <div class="section-body">
                <div class="btn-score-area">
                  <a href="javascript:void(0)" class="point5" onclick="clickStarRating(5,0)"></a>
                  <a href="javascript:void(0)" class="point4" onclick="clickStarRating(4,1)"></a>
                  <a href="javascript:void(0)" class="point3" onclick="clickStarRating(3,2)"></a>
                  <a href="javascript:void(0)" class="point2" onclick="clickStarRating(2,3)"></a>
                  <a href="javascript:void(0)" class="point1" onclick="clickStarRating(1,4)"></a>
                </div>
                <input type="hidden" id="star-rating" value="0"/>

                <div class="commnet-form">
                  <textarea id="comment" cols="30" rows="10" placeholder="오감평가를 등록하고 포인트를 받아보세요."></textarea>
                  <a href="javascript:void(0)" class="btn btn-primary" onclick="addReview()">등록하기</a>
                </div>

                <ul class="comment-list">
                  <li th:each="item : ${reviews}" th:style="${item.bestComment == '1'?'background-color: #f2f6ff; padding-top:30px;':''}">
                    <th:block th:switch="${item.bestComment}">
                      <div class="li-div-best" th:case="1" style="margin-bottom: 25px; margin-top: -25px;">
                        <div class="best-div">BEST</div>
                        <span class="user-id" th:text="${item.userName}"></span>
                      </div>
                      <div th:case="0" style="height: fit-content;width: 70px;    text-overflow: ellipsis">
                        <span class="user-id" th:text="${item.userName}" style="height: fit-content"></span>
                      </div>
                    </th:block>

                    <th:block th:switch="${item.starRating}">
                      <span th:case="5" class="point point5"></span>
                      <span th:case="4" class="point point4"></span>
                      <span th:case="3" class="point point3"></span>
                      <span th:case="2" class="point point2"></span>
                      <span th:case="1" class="point point1"></span>
                    </th:block>
                    <div class="comment" th:text="${item.content}" style="height: fit-content; margin-bottom: 20px;"></div>

                    <th:block th:switch="${item.bestComment}">
                      <a th:case="0" href="javascript:void(0)" class="delete-btn-detail"
                         th:style="${item.userId} == ${userId} ? 'display:block' : 'display:none'"
                         th:onclick="|javascript:deleteReview('${item.reviewId}')|">
                        삭제
                      </a>
                    </th:block>
                  </li>
                </ul>

                <div class="pagination">
                  <th:block th:if="${btnUrls.get('prev') != 'javascript:void(0)'}">
                    <a th:href="${btnUrls.get('prev')}" class="prev"></a>
                  </th:block>
                  <th:block th:if="${btnUrls.get('prev') == 'javascript:void(0)'}">
                    <div style="width: 20px"></div>
                  </th:block>
                  <a th:each="item : ${paginations}" th:href="${item.path}"
                     th:text="${item.idx}" th:class="${item.classValue}"></a>
                  <th:block th:if="${btnUrls.get('next') != 'javascript:void(0)'}">
                    <a th:href="${btnUrls.get('next')}" class="next"></a>
                  </th:block>
                  <th:block th:if="${btnUrls.get('next') == 'javascript:void(0)'}">
                    <div style="width: 20px"></div>
                  </th:block>
                </div>
              </div>
            </div>
          </div>
          <!-- 실제 컨텐츠 영역 END -->
        </div>
      </div>

      <!-- detail footer -->
      <div th:replace="./fragments/detail-footer.html"/>

    </div>
  </div>
  <style>
    .right-area picture{
      padding-left: 10px;
    }
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
  <script type="text/javascript" th:src="@{/js/commons.js}"></script>
  <script type="text/javascript" th:src="@{/js/detail.js}"></script>

  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4c14aafa4e5ccfc24a35c501adea41eb&libraries=services"></script>
  <script th:inline="javascript">
    var mapContainer = document.getElementById('restaurant-map'), // 지도를 표시할 div
            mapOption = {
              center: new kakao.maps.LatLng(38.00994423, 126.9531742), // 지도의 중심좌표
              level: 6 // 지도의 확대 레벨 (레벨 클수록 축소)
            };

    var map = new kakao.maps.Map(mapContainer, mapOption);  // 지도를 생성합니다


    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao.maps.services.Geocoder();

    /*<![CDATA[*/

    var address_name = /*[[ ${payload[0].address} ]]*/;

    /*]]*/

    // 주소로 좌표를 검색합니다
    geocoder.addressSearch(address_name, function(result, status) {

      // 정상적으로 검색이 완료됐으면
      if (status === kakao.maps.services.Status.OK) {

        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

        // 결과값으로 받은 위치를 마커로 표시합니다
        var marker = new kakao.maps.Marker({
          map: map,
          position: coords
        });

        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
        map.setCenter(coords);
      }
    });

    // 지도를 클릭한 위치에 표출할 마커입니다
    var marker = new kakao.maps.Marker({
      // 지도 중심좌표에 마커를 생성합니다
      position: map.getCenter()
    });
    // 지도에 마커를 표시합니다
    marker.setMap(map);

    // 지도에 클릭 이벤트를 등록합니다
    // 지도를 클릭하면 마지막 파라미터로 넘어온 함수를 호출합니다
    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {

      // 클릭한 위도, 경도 정보를 가져옵니다
      var latlng = mouseEvent.latLng;

      // 마커 위치를 클릭한 위치로 옮깁니다
      marker.setPosition(latlng);

      var message = '클릭한 위치의 위도는 ' + latlng.getLat() + ' 이고, ';
      message += '경도는 ' + latlng.getLng() + ' 입니다';

      var resultDiv = document.getElementById('clickLatlng');
      resultDiv.innerHTML = message;

    });

    // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
    var mapTypeControl = new kakao.maps.MapTypeControl();

    // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
    // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

    // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

    function changeMenuImage(e){
        document.getElementById('menu-img-main').style.backgroundImage="url('"+e.src+"')";
    }
  </script>
</div>
</body>
</html>