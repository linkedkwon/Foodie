<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Foodie</title>

    <!-- Custom fonts for this template -->
    <link rel="stylesheet" type="text/css" th:href="@{/vendor/fontawesome-free/css/all.min.css}">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" th:href="@{/css/sb-admin-2.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/adminlte.min.css}" />
    <!-- Custom styles for this page -->
    <link rel="stylesheet" type="text/css" th:href="@{/vendor/datatables/dataTables.bootstrap4.min.css}">

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <div th:replace="./fragments/admin-sidebar.html"> </div>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"></nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4" style="width: 700px;margin:auto;">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary" style="    width: 30%;float: left;" th:text="${background}">레드리스트 맛집목록</h6>
                            <input type="hidden" th:value="${shopBackground}" id="background">
                            <a th:href="@{/admin/registerRedShop}">
                                <button class="btn btn-info btn-sm" style="float: right">맛집 등록하기</button>
                            </a>
                        </div>
                        <div>
                        <div style="width: 90%;margin:auto;margin-top: 20px;    font-size: 9pt;    border: 1px solid lightgray">
                            <div style="    border-bottom: 1px solid lightgray;">
                                <div style="display: inline-flex;">
                                    <div  style="    height: 31px; text-align:center; width: 120px; padding-top: 6px;background: rgb(247, 247, 247);   border-right: 1px solid lightgray"> 음식 카테고리</div>
                                    <p style="    padding-left: 20px;  padding-top: 5px;  margin-bottom: 0;">
                                        <select id="table-filter1" style="    height: 20px;">
                                            <option value="">대분류</option>
                                            <option
                                                    th:each="val : ${categoryInfos}"
                                                    th:value="${val.id}"
                                                    th:utext="${val.listName}"
                                            ></option>
                                        </select>
                                        <select id="table-filter2" style="    height: 20px;">
                                            <option value="">중분류</option>
                                        </select>
                                        <select id="table-filter3" style="    height: 20px;">
                                            <option value="">소분류</option>
                                        </select>
                                    </p>
                                </div>
                            </div>
                            <div style="    border-bottom: 1px solid lightgray;">
                                <div style="display: inline-flex;">
                                    <div  style="    height: 31px; text-align:center; width: 120px; padding-top: 6px;background: rgb(247, 247, 247);   border-right: 1px solid lightgray"> 지역</div>
                                    <p style=" padding-left: 20px; padding-top: 5px; margin-bottom: 0;">
                                        <select id="table-filter4" style="    height: 20px;">
                                            <option value="">1차 지역 선택</option>
                                            <option
                                                th:each="val : ${regionInfos}"
                                                th:value="${val.id}"
                                                th:utext="${val.listName}">
                                            </option>
                                        </select>
                                        <select id="table-filter5" style="height: 20px;">
                                            <option value="">2차 지역 선택</option>
                                        </select>

                                        <select id="table-filter6" style="height: 20px;">
                                            <option value="">3차 지역 선택</option>
                                        </select>
                                    </p>
                                    <p style=" padding-left: 20px; padding-top: 5px; margin-bottom: 0;">
                                        등록서비스
                                        <select id="table-filter7" style="height: 20px;">
                                            <option value="">전체</option>
                                            <option value="">프리미엄</option>
                                            <option value="">인기업소</option>
                                            <option value="">추천업소</option>
                                            <option value="">스폐셜업소</option>
                                            <option value="">줄광고</option>
                                            <option value="">베스트쿠폰</option>
                                        </select>
                                    </p>
                                        <div style="margin-top: 7px; margin-left: 10px;">
                                            <input type="checkbox" name="" style="padding-top: 10px;">
                                        </div>
                                    <p style=" padding-left: 5px; padding-top: 5px; margin-bottom: 0;">
                                        쿠폰
                                    </p>
                                </div>
                            </div>
                            <div style="display: inline-flex;">
                                <div  style="height: 31px; text-align:center; width: 120px;  padding-top: 6px; background: rgb(247, 247, 247); border-right: 1px solid lightgray"> 검색어 </div>
                                <p style="    padding-left: 20px;  padding-top: 5px;  margin-bottom: 0;">
                                    <select id="table-filter8" style="  height: 20px;">
                                        <option value="">선택</option>
                                        <option value="">업소명</option>
                                        <option value="">등록자</option>
                                        <option value="">아이디</option>
                                        <option value="">전화번호</option>
                                    </select>
                                    <input type="text" style="height: 20px; width: 120px;"/>
                                </p>
                            </div>
                            <button value="조회" style="width: 50px;margin-right: 5px;height: 25px;float: right;margin-top: 3px; border-radius: 5px;" onclick="pageReload()">초기화</button>
                            <button value="조회" style="width: 50px;margin-right: 5px;height: 25px;float: right;margin-top: 3px; background-color: #41609b; color: white; border-radius: 5px;" onclick="filterAll()">검색</button>
                        </div>

                        <div class="card-body" style="width:100%; padding-right: 0px;margin: auto;">
                            <div class="table-responsive" style="font-size: 9pt;margin: auto;    padding-right: 20px;">
                                <table class="table table-bordered display" id="example" cellspacing="0">
                                    <thead>
                                    <tr>
                                        <th style="text-align: center" >사진</th>
                                        <th>내용</th>
                                        <th>서비스현황</th>
                                        <th>수정</th>
                                        <th>삭제</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>

                    </div>

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; Your Website 2020</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script th:src="@{/vendor/jquery/jquery.min.js}"></script>
    <script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>

    <!-- Core plugin JavaScript-->
    <script th:src="@{/vendor/jquery-easing/jquery.easing.min.js}"></script>

    <!-- Custom scripts for all pages-->
    <script th:src="@{/js/sb-admin-2.min.js}"></script>

    <!-- Page level plugins -->
    <script th:src="@{/vendor/datatables/jquery.dataTables.min.js}"></script>
    <script th:src="@{/vendor/datatables/dataTables.bootstrap4.min.js}"></script>

    <!-- Page level custom scripts -->
    <script th:src="@{/js/demo/datatables-demo.js}"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/css/bootstrap-select.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/js/bootstrap-select.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
</body>

<style>
    #preview{
        z-index: 9999;
        position:absolute;
        border:0px solid #ccc;
        background:#333;
        padding:1px;
        display:none;
        color:#fff;
    }

    table{
        table-layout: fixed;
        word-wrap:break-word;
    }
    .table td, .table th{
        padding: 7px !important;
        text-align: center;
    }

    .table td{
        text-align: center;
    }
    .table td:nth-child(2){
        text-align: left;
    }

    /*.data_table {*/
    /*    text-align: center;*/
    /*    vertical-align: middle !important;*/
    /*}*/
</style>
<script type="text/javascript">
    $(document).ready(function() {
        var xOffset = 10;
        var yOffset = 30;

        $(document).on("mouseover",".thumbnail",function(e){ //마우스 오버시

            $("body").append("<p id='preview'><img src='"+ $(this).attr("src") +"' width='400px' /></p>"); //보여줄 이미지를 선언
            $("#preview")
                .css("top",(e.pageY - xOffset) + "px")
                .css("left",(e.pageX + yOffset) + "px")
                .fadeIn("fast"); //미리보기 화면 설정 셋팅
        });

        $(document).on("mousemove",".thumbnail",function(e){ //마우스 이동시
            $("#preview")
                .css("top",(e.pageY - xOffset) + "px")
                .css("left",(e.pageX + yOffset) + "px");
        });

        $(document).on("mouseout",".thumbnail",function(){ //마우스 아웃시
            $("#preview").remove();
        });




        var background = $('#background').val();
        $('#example').DataTable( {
            "ajax": "/admin/category/"+background+"/all",
            ordering: false,
            "pageLength": 30,
            // "paging":true,
            "columns": [
                // <div>
                //     <a th:href="@{'/admin/shop/red/'+${shop.shopId}}" th:text="${shop.shopName}"></a>
                // </div>
                // <div>
                //     <span th:text="${'주소- ' + shop.address}"></span>
                // </div>

                { 'data': "menuImages", 'render': function ( data, type, row) {
                        if(data == "" || data == "[]"){
                            return '<img src="/images/default.png" class="thumbnail" style="width: 80px;height:60px;" />';
                        }else{
                            return '<img src="' + row.menuImages + '" class="thumbnail" style="width: 80px;height:60px;" />';
                        }
                    }
                },
                { "data": "shopName" , 'render': function  ( data, type, row ) { return '<div><a href="/admin/shop/green/'+ row.shopId +'">'+ data + '</a> ( 푸디평점 - ' + row.foodieLogRating + ') </div><div><span> 주소 -'+ row.address +'</span></div>'; } },
                { "data": "shopPaid" },
                { "data": "updatedAt", 'render': function  ( data, type, row ) {
                        if(data == null){
                            return ''
                        }
                        return moment(data).format("YYYY-MM-DD HH:mm");
                    }
                },
                { "data": "createdAt", 'render': function  ( data, type, row ) { return moment(data).format("YYYY-MM-DD HH:mm"); }  },
            ],
            "columnDefs": [
                { "width": "15%","targets": 0},
                { "width": "45%", "targets": 1},
                { "width": "10%", "targets": 2},
                { "width": "15%", "targets": 3},
                { "width": "15%", "targets": 4},
            ],
            /*initComplete: function () {
                this.api().columns().every( function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                        .appendTo( $(column.footer()).empty() )
                        .on( 'change', function () {
                            var val = $.fn.dataTable.util.escapeRegex(
                                $(this).val()
                            );

                            column
                                .search( val ? '^'+val+'$' : '', true, false )
                                .draw();
                        } );

                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );
            }*/
        } );

        $('#table-filter1').change( function(){
            get_mcode( this ); // 셀렉트 박스 선택이 바뀔때 "셀렉트박스 요소" 를 함수로 전달
        });


        function get_mcode(o){
            var val = $( ':selected', o).val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
            console.log(val)
            if(val != ''){
                $.ajax({
                    type:"get",
                    url:"/admin/category/mfood/" + val,
                    datatype: "json",
                    success: function(data) {
                        if(data.length > 0) {
                            $("#table-filter2").find("option").remove().end();
                            $("#table-filter2").append("<option>중분류</option>");
                            $.each(data, function(key, value) {
                                $("#table-filter2").append("<option value='" + value.no + "'>" + value.listName + "</option>");
                            });
                            console.log(data[0])
                        } else {
                            $("#table-filter2").find("option").remove().end().append("<option value='0'>NO DATA</option>");
                            $("#table-filter3").find("option").remove().end();
                            $("#table-filter3").append("<option value='0'>NO DATA</option>");
                            return;
                        }
                    },

                    error: function(x, o, e) {
                        var msg = "페이지 호출 중 에러 발생 \n" + x.status + " : " + o + " : " + e;
                        alert(msg);
                    }
                });
            }else {
                $("#table-filter2").find("option").remove().end();
                $("#table-filter2").append("<option value='0'>중분류</option>");
                $("#table-filter3").find("option").remove().end();
                $("#table-filter3").append("<option value='0'>소분류</option>");
            }
        }

        $('#table-filter2').change( function(){
            get_scode( this ); // 셀렉트 박스 선택이 바뀔때 "셀렉트박스 요소" 를 함수로 전달
        });

        function get_scode(o){
            var val = $( ':selected', o).val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
            console.log(val)
            if(val != '') {
                $.ajax({
                    type: "get",
                    url: "/admin/category/sfood/" + val,
                    datatype: "json",
                    success: function (data) {
                        if (data.length > 0) {
                            $("#table-filter3").find("option").remove().end();
                            $("#table-filter3").append("<option>소분류</option>");
                            $.each(data, function (key, value) {
                                $("#table-filter3").append("<option value='" + value.scode + "'>" + value.categoryName + "</option>");
                            });
                        } else {
                            $("#table-filter3").find("option").remove().end().append("<option value='0'>NO DATA</option>");
                            return;
                        }
                    },

                    error: function (x, o, e) {
                        var msg = "페이지 호출 중 에러 발생 \n" + x.status + " : " + o + " : " + e;
                        alert(msg);
                    }
                });
            }else{
                $("#table-filter3").find("option").remove().end();
                $("#table-filter3").append("<option value='0'>소분류 </option>");
            }
        }



        $('#table-filter4').change( function(){
            get_detail_region( this ); // 셀렉트 박스 선택이 바뀔때 "셀렉트박스 요소" 를 함수로 전달
        });

        function get_detail_region(o){
            var val = $( ':selected', o).val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
            console.log(val)
            if(val != ''){
                $.ajax({
                    type:"get",
                    url:"/admin/region/" + val,
                    datatype: "json",
                    success: function(data) {
                        if(data.length > 0) {
                            $("#table-filter5").find("option").remove().end();
                            $("#table-filter4").append("<option>중분류</option>");
                            $.each(data, function(key, value) {
                                $("#table-filter5").append("<option value='" + value.id + "'>" + value.listName + "</option>");
                            });
                        } else {
                            $("#table-filter3").find("option").remove().end().append("<option>NO DATA</option>");
                            return;
                        }
                    },

                    error: function(x, o, e) {
                        var msg = "페이지 호출 중 에러 발생 \n" + x.status + " : " + o + " : " + e;
                        alert(msg);
                    }
                });
            }else{
                $("#table-filter5").find("option").remove().end();
                $("#table-filter5").append("<option>군</option>");
            }
        }
    } );

    function filterFoodCategory(){
        console.log('00000')
        var bCode = $('#table-filter1 :selected').val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
        var mCode = $('#table-filter2 :selected').val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
        var sCode = $('#table-filter3 :selected').val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기
        var regionId = $('#table-filter5 :selected').val(); // 전달받은 "셀렉트박스 요소" 에서 선택된 것 찾기

        var query = null;
        if(bCode != '' && mCode != '' && sCode != ''){
            query = "bCode=" + bCode + "&mCode=" + mCode + "&sCode=" + sCode;
        }else if(bCode != '' && mCode != '' && sCode == ''){
            query = "bCode=" + bCode + "&mCode=" + mCode + "&sCode=0";
        }else if(bCode != '' && mCode == '' && sCode != ''){
            query = "bCode=" + bCode + "&mCode=0&sCode=0";
        }
        console.log(regionId + '^&*^&*^*');
        if(regionId == "군" || regionId == ''){
            query = query + "&regionId=0";
        }else{
            query = query + "&regionId=" + regionId;
        }
        // console.log(val)
        $('#example').dataTable().fnClearTable();
        $.ajax({
            type:"get",
            url:"/admin/category/green/filter?" + query,
            datatype: "json",
            success: function(data) {
                if(data.length > 0) {
                    var response_data = [];
                    for (step = 0; step < data.length; step++) {
                        // Runs 5 times, with values of step 0 through 4.
                        response_data.push(data[step])
                    }
                    console.log(response_data)
                    // $('#example tbody tr').replaceWith(data);
                    // $('#payload tr').remove();
                    // $('#payload').html(data);
                    $('#example').dataTable().fnAddData(response_data);
                    // $.each(data, function(key, value) {
                    //     $("#example tbody").append("<tr>" +
                    //         "<td> hihihii </td>" +
                    //         "<td> hihihii </td>" +
                    //         "<td> hihihii </td>" +
                    //         "<td> hihihii </td>" +
                    //         "<td> hihihii </td>" +
                    //         "</tr>");
                    // });

                } else {
                    return;
                }
            },

            error: function(x, o, e) {
                var msg = "페이지 호출 중 에러 발생 \n" + x.status + " : " + o + " : " + e;
                alert(msg);
            }
        });
    }

    // $('.selectpicker').selectpicker();

</script>

</html>